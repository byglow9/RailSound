function t(r,p,y,C){return new(y||(y=Promise))((function(w,S){function o(r){try{h(C.next(r))}catch(r){S(r)}}function a(r){try{h(C.throw(r))}catch(r){S(r)}}function h(r){var p;r.done?w(r.value):(p=r.value,p instanceof y?p:new y((function(r){r(p)}))).then(o,a)}h((C=C.apply(r,p||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class e{constructor(){this.listeners={}}on(r,p,y){if(this.listeners[r]||(this.listeners[r]=new Set),this.listeners[r].add(p),null==y?void 0:y.once){const i=()=>{this.un(r,i),this.un(r,p)};return this.on(r,i),i}return()=>this.un(r,p)}un(r,p){var y;null===(y=this.listeners[r])||void 0===y||y.delete(p)}once(r,p){return this.on(r,p,{once:!0})}unAll(){this.listeners={}}emit(r,...p){this.listeners[r]&&this.listeners[r].forEach((r=>r(...p)))}}const r={decode:function(r,p){return t(this,void 0,void 0,(function*(){const y=new AudioContext({sampleRate:p});return y.decodeAudioData(r).finally((()=>y.close()))}))},createBuffer:function(r,p){return"number"==typeof r[0]&&(r=[r]),function(r){const p=r[0];if(p.some((r=>r>1||r<-1))){const y=p.length;let C=0;for(let r=0;r<y;r++){const y=Math.abs(p[r]);y>C&&(C=y)}for(const p of r)for(let r=0;r<y;r++)p[r]/=C}}(r),{duration:p,length:r[0].length,sampleRate:r[0].length/p,numberOfChannels:r.length,getChannelData:p=>null==r?void 0:r[p],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function n(r,p){const y=p.xmlns?document.createElementNS(p.xmlns,r):document.createElement(r);for(const[r,C]of Object.entries(p))if("children"===r)for(const[r,C]of Object.entries(p))"string"==typeof C?y.appendChild(document.createTextNode(C)):y.appendChild(n(r,C));else"style"===r?Object.assign(y.style,C):"textContent"===r?y.textContent=C:y.setAttribute(r,C.toString());return y}function s(r,p,y){const C=n(r,p||{});return null==y||y.appendChild(C),C}var p=Object.freeze({__proto__:null,createElement:s,default:s});const y={fetchBlob:function(r,p,y){return t(this,void 0,void 0,(function*(){const C=yield fetch(r,y);if(C.status>=400)throw new Error(`Failed to fetch ${r}: ${C.status} (${C.statusText})`);return function(r,p){t(this,void 0,void 0,(function*(){if(!r.body||!r.headers)return;const y=r.body.getReader(),C=Number(r.headers.get("Content-Length"))||0;let w=0;const o=r=>t(this,void 0,void 0,(function*(){w+=(null==r?void 0:r.length)||0;const y=Math.round(w/C*100);p(y)})),a=()=>t(this,void 0,void 0,(function*(){let r;try{r=yield y.read()}catch(r){return}r.done||(o(r.value),yield a())}));a()}))}(C.clone(),p),C.blob()}))}};class a extends e{constructor(r){super(),this.isExternalMedia=!1,r.media?(this.media=r.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),r.mediaControls&&(this.media.controls=!0),r.autoplay&&(this.media.autoplay=!0),null!=r.playbackRate&&this.onMediaEvent("canplay",(()=>{null!=r.playbackRate&&(this.media.playbackRate=r.playbackRate)}),{once:!0})}onMediaEvent(r,p,y){return this.media.addEventListener(r,p,y),()=>this.media.removeEventListener(r,p,y)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){const r=this.getSrc();r.startsWith("blob:")&&URL.revokeObjectURL(r)}canPlayType(r){return""!==this.media.canPlayType(r)}setSrc(r,p){if(this.getSrc()===r)return;this.revokeSrc();const y=p instanceof Blob&&this.canPlayType(p.type)?URL.createObjectURL(p):r;this.media.src=y}destroy(){this.media.pause(),this.isExternalMedia||(this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(r){this.media=r}play(){return t(this,void 0,void 0,(function*(){return this.media.play()}))}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(r){this.media.currentTime=r}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(r){this.media.volume=r}getMuted(){return this.media.muted}setMuted(r){this.media.muted=r}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(r,p){null!=p&&(this.media.preservesPitch=p),this.media.playbackRate=r}getMediaElement(){return this.media}setSinkId(r){return this.media.setSinkId(r)}}class h extends e{constructor(r,p){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.subscriptions=[],this.options=r;const y=this.parentFromOptionsContainer(r.container);this.parent=y;const[C,w]=this.initHtml();y.appendChild(C),this.container=C,this.scrollContainer=w.querySelector(".scroll"),this.wrapper=w.querySelector(".wrapper"),this.canvasWrapper=w.querySelector(".canvases"),this.progressWrapper=w.querySelector(".progress"),this.cursor=w.querySelector(".cursor"),p&&w.appendChild(p),this.initEvents()}parentFromOptionsContainer(r){let p;if("string"==typeof r?p=document.querySelector(r):r instanceof HTMLElement&&(p=r),!p)throw new Error("Container not found");return p}initEvents(){const t=r=>{const p=this.wrapper.getBoundingClientRect(),y=r.clientX-p.left,C=r.clientY-p.top;return[y/p.width,C/p.height]};this.wrapper.addEventListener("click",(r=>{const[p,y]=t(r);this.emit("click",p,y)})),this.wrapper.addEventListener("dblclick",(r=>{const[p,y]=t(r);this.emit("dblclick",p,y)})),!0!==this.options.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.scrollContainer.addEventListener("scroll",(()=>{const{scrollLeft:r,scrollWidth:p,clientWidth:y}=this.scrollContainer,C=r/p,w=(r+y)/p;this.emit("scroll",C,w)}));const r=this.createDelay(100);this.resizeObserver=new ResizeObserver((()=>{r().then((()=>this.onContainerResize())).catch((()=>{}))})),this.resizeObserver.observe(this.scrollContainer)}onContainerResize(){const r=this.parent.clientWidth;r===this.lastContainerWidth&&"auto"!==this.options.height||(this.lastContainerWidth=r,this.reRender())}initDrag(){this.subscriptions.push(function(r,p,y,C,w=3,S=0,E=100){if(!r)return()=>{};const x=matchMedia("(pointer: coarse)").matches;let h=()=>{};const l=M=>{if(M.button!==S)return;M.preventDefault(),M.stopPropagation();let k=M.clientX,P=M.clientY,D=!1;const T=Date.now(),m=C=>{if(C.preventDefault(),C.stopPropagation(),x&&Date.now()-T<E)return;const S=C.clientX,M=C.clientY,R=S-k,L=M-P;if(D||Math.abs(R)>w||Math.abs(L)>w){const C=r.getBoundingClientRect(),{left:w,top:E}=C;D||(null==y||y(k-w,P-E),D=!0),p(R,L,S-w,M-E),k=S,P=M}},f=p=>{if(D){const y=p.clientX,w=p.clientY,S=r.getBoundingClientRect(),{left:E,top:x}=S;null==C||C(y-E,w-x)}h()},g=r=>{r.relatedTarget&&r.relatedTarget!==document.documentElement||f(r)},v=r=>{D&&(r.stopPropagation(),r.preventDefault())},b=r=>{D&&r.preventDefault()};document.addEventListener("pointermove",m),document.addEventListener("pointerup",f),document.addEventListener("pointerout",g),document.addEventListener("pointercancel",g),document.addEventListener("touchmove",b,{passive:!1}),document.addEventListener("click",v,{capture:!0}),h=()=>{document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",f),document.removeEventListener("pointerout",g),document.removeEventListener("pointercancel",g),document.removeEventListener("touchmove",b),setTimeout((()=>{document.removeEventListener("click",v,{capture:!0})}),10)}};return r.addEventListener("pointerdown",l),()=>{h(),r.removeEventListener("pointerdown",l)}}(this.wrapper,((r,p,y)=>{this.emit("drag",Math.max(0,Math.min(1,y/this.wrapper.getBoundingClientRect().width)))}),(r=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))}),(r=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,r/this.wrapper.getBoundingClientRect().width)))})))}getHeight(r,p){var y;const C=(null===(y=this.audioData)||void 0===y?void 0:y.numberOfChannels)||1;if(null==r)return 128;if(!isNaN(Number(r)))return Number(r);if("auto"===r){const r=this.parent.clientHeight||128;return(null==p?void 0:p.every((r=>!r.overlay)))?r/C:r}return 128}initHtml(){const r=document.createElement("div"),p=r.attachShadow({mode:"open"});return p.innerHTML=`\n      <style>\n        :host {\n          user-select: none;\n          min-width: 1px;\n        }\n        :host audio {\n          display: block;\n          width: 100%;\n        }\n        :host .scroll {\n          overflow-x: auto;\n          overflow-y: hidden;\n          width: 100%;\n          position: relative;\n        }\n        :host .noScrollbar {\n          scrollbar-color: transparent;\n          scrollbar-width: none;\n        }\n        :host .noScrollbar::-webkit-scrollbar {\n          display: none;\n          -webkit-appearance: none;\n        }\n        :host .wrapper {\n          position: relative;\n          overflow: visible;\n          z-index: 2;\n        }\n        :host .canvases {\n          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;\n        }\n        :host .canvases > div {\n          position: relative;\n        }\n        :host canvas {\n          display: block;\n          position: absolute;\n          top: 0;\n          image-rendering: pixelated;\n        }\n        :host .progress {\n          pointer-events: none;\n          position: absolute;\n          z-index: 2;\n          top: 0;\n          left: 0;\n          width: 0;\n          height: 100%;\n          overflow: hidden;\n        }\n        :host .progress > div {\n          position: relative;\n        }\n        :host .cursor {\n          pointer-events: none;\n          position: absolute;\n          z-index: 5;\n          top: 0;\n          left: 0;\n          height: 100%;\n          border-radius: 2px;\n        }\n      </style>\n\n      <div class="scroll" part="scroll">\n        <div class="wrapper" part="wrapper">\n          <div class="canvases" part="canvases"></div>\n          <div class="progress" part="progress"></div>\n          <div class="cursor" part="cursor"></div>\n        </div>\n      </div>\n    `,[r,p]}setOptions(r){if(this.options.container!==r.container){const p=this.parentFromOptionsContainer(r.container);p.appendChild(this.container),this.parent=p}!0!==r.dragToSeek&&"object"!=typeof this.options.dragToSeek||this.initDrag(),this.options=r,this.reRender()}getWrapper(){return this.wrapper}getScroll(){return this.scrollContainer.scrollLeft}setScroll(r){this.scrollContainer.scrollLeft=r}setScrollPercentage(r){const{scrollWidth:p}=this.scrollContainer,y=p*r;this.setScroll(y)}destroy(){var r;this.subscriptions.forEach((r=>r())),this.container.remove(),null===(r=this.resizeObserver)||void 0===r||r.disconnect()}createDelay(r=10){let p,y;const n=()=>{p&&clearTimeout(p),y&&y()};return this.timeouts.push(n),()=>new Promise(((C,w)=>{n(),y=w,p=setTimeout((()=>{p=void 0,y=void 0,C()}),r)}))}convertColorValues(r){if(!Array.isArray(r))return r||"";if(r.length<2)return r[0]||"";const p=document.createElement("canvas"),y=p.getContext("2d"),C=p.height*(window.devicePixelRatio||1),w=y.createLinearGradient(0,0,0,C),S=1/(r.length-1);return r.forEach(((r,p)=>{const y=p*S;w.addColorStop(y,r)})),w}renderBarWaveform(r,p,y,C){const w=r[0],S=r[1]||r[0],E=w.length,{width:x,height:M}=y.canvas,k=M/2,P=window.devicePixelRatio||1,D=p.barWidth?p.barWidth*P:1,T=p.barGap?p.barGap*P:p.barWidth?D/2:0,R=p.barRadius||0,L=x/(D+T)/E,W=R&&"roundRect"in y?"roundRect":"rect";y.beginPath();let N=0,O=0,A=0;for(let r=0;r<=E;r++){const E=Math.round(r*L);if(E>N){const r=Math.round(O*k*C),w=r+Math.round(A*k*C)||1;let S=k-r;"top"===p.barAlign?S=0:"bottom"===p.barAlign&&(S=M-w),y[W](N*(D+T),S,D,w,R),N=E,O=0,A=0}const x=Math.abs(w[r]||0),P=Math.abs(S[r]||0);x>O&&(O=x),P>A&&(A=P)}y.fill(),y.closePath()}renderLineWaveform(r,p,y,C){const s=p=>{const w=r[p]||r[0],S=w.length,{height:E}=y.canvas,x=E/2,M=y.canvas.width/S;y.moveTo(0,x);let k=0,P=0;for(let r=0;r<=S;r++){const S=Math.round(r*M);if(S>k){const r=x+(Math.round(P*x*C)||1)*(0===p?-1:1);y.lineTo(k,r),k=S,P=0}const E=Math.abs(w[r]||0);E>P&&(P=E)}y.lineTo(k,x)};y.beginPath(),s(0),s(1),y.fill(),y.closePath()}renderWaveform(r,p,y){if(y.fillStyle=this.convertColorValues(p.waveColor),p.renderFunction)return void p.renderFunction(r,y);let C=p.barHeight||1;if(p.normalize){const p=Array.from(r[0]).reduce(((r,p)=>Math.max(r,Math.abs(p))),0);C=p?1/p:1}p.barWidth||p.barGap||p.barAlign?this.renderBarWaveform(r,p,y,C):this.renderLineWaveform(r,p,y,C)}renderSingleCanvas(r,p,y,C,w,S,E){const x=window.devicePixelRatio||1,M=document.createElement("canvas");M.width=Math.round(y*x),M.height=Math.round(C*x),M.style.width=`${y}px`,M.style.height=`${C}px`,M.style.left=`${Math.round(w)}px`,S.appendChild(M);const k=M.getContext("2d");if(this.renderWaveform(r,p,k),M.width>0&&M.height>0){const r=M.cloneNode(),y=r.getContext("2d");y.drawImage(M,0,0),y.globalCompositeOperation="source-in",y.fillStyle=this.convertColorValues(p.progressColor),y.fillRect(0,0,M.width,M.height),E.appendChild(r)}}renderMultiCanvas(r,p,y,C,w,S){return t(this,void 0,void 0,(function*(){const E=window.devicePixelRatio||1,x=y/E;let M=Math.min(h.MAX_CANVAS_WIDTH,this.scrollContainer.clientWidth);if(p.barWidth||p.barGap){const r=p.barWidth||.5,y=r+(p.barGap||r/2);M%y!=0&&(M=Math.floor(M/y)*y)}const c=y=>{const E=y*M,k=Math.min(x-E,M),P=r.map((r=>{const p=Math.floor(E/x*r.length),y=Math.floor((E+k)/x*r.length);return r.slice(p,y)}));this.renderSingleCanvas(P,p,k,C,E,w,S)},k=Math.ceil(x/M);if(1===k)return void c(0);const P=this.scrollContainer.scrollLeft/x,D=Math.floor(P*k);c(D),c(D+1),yield Promise.all([(()=>t(this,void 0,void 0,(function*(){const r=this.createDelay();for(let p=D-1;p>=0;p--)yield r(),c(p)})))(),(()=>t(this,void 0,void 0,(function*(){const r=this.createDelay();for(let p=D+2;p<k;p++)yield r(),c(p)})))()])}))}renderChannel(r,p,y,C){return t(this,void 0,void 0,(function*(){var{overlay:w}=p,S=function(r,p){var y={};for(var C in r)Object.prototype.hasOwnProperty.call(r,C)&&p.indexOf(C)<0&&(y[C]=r[C]);if(null!=r&&"function"==typeof Object.getOwnPropertySymbols){var w=0;for(C=Object.getOwnPropertySymbols(r);w<C.length;w++)p.indexOf(C[w])<0&&Object.prototype.propertyIsEnumerable.call(r,C[w])&&(y[C[w]]=r[C[w]])}return y}(p,["overlay"]);const E=document.createElement("div"),x=this.getHeight(S.height,S.splitChannels);E.style.height=`${x}px`,w&&C>0&&(E.style.marginTop=`-${x}px`),this.canvasWrapper.style.minHeight=`${x}px`,this.canvasWrapper.appendChild(E);const M=E.cloneNode();this.progressWrapper.appendChild(M),yield this.renderMultiCanvas(r,S,y,x,E,M)}))}render(r){return t(this,void 0,void 0,(function*(){this.timeouts.forEach((r=>r())),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",null!=this.options.width&&(this.scrollContainer.style.width="number"==typeof this.options.width?`${this.options.width}px`:this.options.width);const p=window.devicePixelRatio||1,y=this.scrollContainer.clientWidth,C=Math.ceil(r.duration*(this.options.minPxPerSec||0));this.isScrollable=C>y;const w=this.options.fillParent&&!this.isScrollable,S=(w?y:C)*p;this.wrapper.style.width=w?"100%":`${C}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=r,this.emit("render");try{if(this.options.splitChannels)yield Promise.all(Array.from({length:r.numberOfChannels}).map(((p,y)=>{var C;const w=Object.assign(Object.assign({},this.options),null===(C=this.options.splitChannels)||void 0===C?void 0:C[y]);return this.renderChannel([r.getChannelData(y)],w,S,y)})));else{const p=[r.getChannelData(0)];r.numberOfChannels>1&&p.push(r.getChannelData(1)),yield this.renderChannel(p,this.options,S,0)}}catch(p){return}this.emit("rendered")}))}reRender(){if(!this.audioData)return;const{scrollWidth:r}=this.scrollContainer,{right:p}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&r!==this.scrollContainer.scrollWidth){const{right:r}=this.progressWrapper.getBoundingClientRect();let y=r-p;y*=2,y=y<0?Math.floor(y):Math.ceil(y),y/=2,this.scrollContainer.scrollLeft+=y}}zoom(r){this.options.minPxPerSec=r,this.reRender()}scrollIntoView(r,p=!1){const{scrollLeft:y,scrollWidth:C,clientWidth:w}=this.scrollContainer,S=r*C,E=y,x=y+w,M=w/2;if(this.isDragging){const r=30;S+r>x?this.scrollContainer.scrollLeft+=r:S-r<E&&(this.scrollContainer.scrollLeft-=r)}else{(S<E||S>x)&&(this.scrollContainer.scrollLeft=S-(this.options.autoCenter?M:0));const r=S-y-M;p&&this.options.autoCenter&&r>0&&(this.scrollContainer.scrollLeft+=Math.min(r,10))}{const r=this.scrollContainer.scrollLeft,p=r/C,y=(r+w)/C;this.emit("scroll",p,y)}}renderProgress(r,p){if(isNaN(r))return;const y=100*r;this.canvasWrapper.style.clipPath=`polygon(${y}% 0, 100% 0, 100% 100%, ${y}% 100%)`,this.progressWrapper.style.width=`${y}%`,this.cursor.style.left=`${y}%`,this.cursor.style.transform=`translateX(-${100===Math.round(y)?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(r,p)}exportImage(r,p,y){return t(this,void 0,void 0,(function*(){const C=this.canvasWrapper.querySelectorAll("canvas");if(!C.length)throw new Error("No waveform data");if("dataURL"===y){const y=Array.from(C).map((y=>y.toDataURL(r,p)));return Promise.resolve(y)}return Promise.all(Array.from(C).map((y=>new Promise(((C,w)=>{y.toBlob((r=>{r?C(r):w(new Error("Could not export image"))}),r,p)})))))}))}}h.MAX_CANVAS_WIDTH=4e3;class l extends e{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",(()=>{requestAnimationFrame((()=>{this.emit("tick")}))})),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class d extends e{constructor(r=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=r,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return t(this,void 0,void 0,(function*(){}))}get src(){return this.currentSrc}set src(r){if(this.currentSrc=r,this._duration=void 0,!r)return this.buffer=null,void this.emit("emptied");fetch(r).then((p=>{if(p.status>=400)throw new Error(`Failed to fetch ${r}: ${p.status} (${p.statusText})`);return p.arrayBuffer()})).then((p=>this.currentSrc!==r?null:this.audioContext.decodeAudioData(p))).then((p=>{this.currentSrc===r&&(this.buffer=p,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}))}_play(){var r;if(!this.paused)return;this.paused=!1,null===(r=this.bufferNode)||void 0===r||r.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let p=this.playedDuration*this._playbackRate;p>=this.duration&&(p=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,p),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var r;this.paused=!0,null===(r=this.bufferNode)||void 0===r||r.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return t(this,void 0,void 0,(function*(){this.paused&&(this._play(),this.emit("play"))}))}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(r){var p,y;const C=r-this.currentTime;null===(p=this.bufferNode)||void 0===p||p.stop(this.audioContext.currentTime+C),null===(y=this.bufferNode)||void 0===y||y.addEventListener("ended",(()=>{this.bufferNode=null,this.pause()}),{once:!0})}setSinkId(r){return t(this,void 0,void 0,(function*(){return this.audioContext.setSinkId(r)}))}get playbackRate(){return this._playbackRate}set playbackRate(r){this._playbackRate=r,this.bufferNode&&(this.bufferNode.playbackRate.value=r)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(r){const p=!this.paused;p&&this._pause(),this.playedDuration=r/this._playbackRate,p&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var r,p;return null!==(r=this._duration)&&void 0!==r?r:(null===(p=this.buffer)||void 0===p?void 0:p.duration)||0}set duration(r){this._duration=r}get volume(){return this.gainNode.gain.value}set volume(r){this.gainNode.gain.value=r,this.emit("volumechange")}get muted(){return this._muted}set muted(r){this._muted!==r&&(this._muted=r,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(r){return/^(audio|video)\//.test(r)}getGainNode(){return this.gainNode}getChannelData(){const r=[];if(!this.buffer)return r;const p=this.buffer.numberOfChannels;for(let y=0;y<p;y++)r.push(this.buffer.getChannelData(y));return r}}const C={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8e3};class u extends a{static create(r){return new u(r)}constructor(r){const p=r.media||("WebAudio"===r.backend?new d:void 0);super({media:p,mediaControls:r.mediaControls,autoplay:r.autoplay,playbackRate:r.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},C,r),this.timer=new l;const y=p?void 0:this.getMediaElement();this.renderer=new h(this.options,y),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();const w=this.options.url||this.getSrc()||"";Promise.resolve().then((()=>{this.emit("init");const{peaks:r,duration:p}=this.options;(w||r&&p)&&this.load(w,r,p).catch((()=>null))}))}updateProgress(r=this.getCurrentTime()){return this.renderer.renderProgress(r/this.getDuration(),this.isPlaying()),r}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",(()=>{if(!this.isSeeking()){const r=this.updateProgress();this.emit("timeupdate",r),this.emit("audioprocess",r)}})))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",(()=>{const r=this.updateProgress();this.emit("timeupdate",r)})),this.onMediaEvent("play",(()=>{this.emit("play"),this.timer.start()})),this.onMediaEvent("pause",(()=>{this.emit("pause"),this.timer.stop()})),this.onMediaEvent("emptied",(()=>{this.timer.stop()})),this.onMediaEvent("ended",(()=>{this.emit("finish")})),this.onMediaEvent("seeking",(()=>{this.emit("seeking",this.getCurrentTime())})),this.onMediaEvent("error",(r=>{this.emit("error",r.error)})))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",((r,p)=>{this.options.interact&&(this.seekTo(r),this.emit("interaction",r*this.getDuration()),this.emit("click",r,p))})),this.renderer.on("dblclick",((r,p)=>{this.emit("dblclick",r,p)})),this.renderer.on("scroll",((r,p)=>{const y=this.getDuration();this.emit("scroll",r*y,p*y)})),this.renderer.on("render",(()=>{this.emit("redraw")})),this.renderer.on("rendered",(()=>{this.emit("redrawcomplete")})),this.renderer.on("dragstart",(r=>{this.emit("dragstart",r)})),this.renderer.on("dragend",(r=>{this.emit("dragend",r)})));{let r;this.subscriptions.push(this.renderer.on("drag",(p=>{if(!this.options.interact)return;let y;this.renderer.renderProgress(p),clearTimeout(r),this.isPlaying()?y=0:!0===this.options.dragToSeek?y=200:"object"==typeof this.options.dragToSeek&&void 0!==this.options.dragToSeek&&(y=this.options.dragToSeek.debounceTime),r=setTimeout((()=>{this.seekTo(p)}),y),this.emit("interaction",p*this.getDuration()),this.emit("drag",p)})))}}initPlugins(){var r;(null===(r=this.options.plugins)||void 0===r?void 0:r.length)&&this.options.plugins.forEach((r=>{this.registerPlugin(r)}))}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((r=>r())),this.mediaSubscriptions=[]}setOptions(r){this.options=Object.assign({},this.options,r),this.renderer.setOptions(this.options),r.audioRate&&this.setPlaybackRate(r.audioRate),null!=r.mediaControls&&(this.getMediaElement().controls=r.mediaControls)}registerPlugin(r){return r._init(this),this.plugins.push(r),this.subscriptions.push(r.once("destroy",(()=>{this.plugins=this.plugins.filter((p=>p!==r))}))),r}getWrapper(){return this.renderer.getWrapper()}getScroll(){return this.renderer.getScroll()}setScroll(r){return this.renderer.setScroll(r)}setScrollTime(r){const p=r/this.getDuration();this.renderer.setScrollPercentage(p)}getActivePlugins(){return this.plugins}loadAudio(p,C,w,S){return t(this,void 0,void 0,(function*(){var E;if(this.emit("load",p),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!C&&!w){const r=this.options.fetchParams||{};window.AbortController&&!r.signal&&(this.abortController=new AbortController,r.signal=null===(E=this.abortController)||void 0===E?void 0:E.signal);const s=r=>this.emit("loading",r);C=yield y.fetchBlob(p,s,r)}this.setSrc(p,C);const x=S||this.getDuration()||(yield new Promise((r=>{this.onMediaEvent("loadedmetadata",(()=>r(this.getDuration())),{once:!0})})));if(!p&&!C){const r=this.getMediaElement();r instanceof d&&(r.duration=x)}if(w)this.decodedData=r.createBuffer(w,x||0);else if(C){const p=yield C.arrayBuffer();this.decodedData=yield r.decode(p,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())}))}load(r,p,y){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio(r,void 0,p,y)}catch(r){throw this.emit("error",r),r}}))}loadBlob(r,p,y){return t(this,void 0,void 0,(function*(){try{return yield this.loadAudio("blob",r,p,y)}catch(r){throw this.emit("error",r),r}}))}zoom(r){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(r),this.emit("zoom",r)}getDecodedData(){return this.decodedData}exportPeaks({channels:r=2,maxLength:p=8e3,precision:y=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");const C=Math.min(r,this.decodedData.numberOfChannels),w=[];for(let r=0;r<C;r++){const C=this.decodedData.getChannelData(r),S=[],E=C.length/p;for(let r=0;r<p;r++){const p=C.slice(Math.floor(r*E),Math.ceil((r+1)*E));let w=0;for(let r=0;r<p.length;r++){const y=p[r];Math.abs(y)>Math.abs(w)&&(w=y)}S.push(Math.round(w*y)/y)}w.push(S)}return w}getDuration(){let r=super.getDuration()||0;return 0!==r&&r!==1/0||!this.decodedData||(r=this.decodedData.duration),r}toggleInteraction(r){this.options.interact=r}setTime(r){super.setTime(r),this.updateProgress(r),this.emit("timeupdate",r)}seekTo(r){const p=this.getDuration()*r;this.setTime(p)}playPause(){return t(this,void 0,void 0,(function*(){return this.isPlaying()?this.pause():this.play()}))}stop(){this.pause(),this.setTime(0)}skip(r){this.setTime(this.getCurrentTime()+r)}empty(){this.load("",[[0]],.001)}setMediaElement(r){this.unsubscribePlayerEvents(),super.setMediaElement(r),this.initPlayerEvents()}exportImage(){return t(this,arguments,void 0,(function*(r="image/png",p=1,y="dataURL"){return this.renderer.exportImage(r,p,y)}))}destroy(){var r;this.emit("destroy"),null===(r=this.abortController)||void 0===r||r.abort(),this.plugins.forEach((r=>r.destroy())),this.subscriptions.forEach((r=>r())),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}u.BasePlugin=class extends e{constructor(r){super(),this.subscriptions=[],this.options=r}onInit(){}_init(r){this.wavesurfer=r,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((r=>r()))}},u.dom=p;export{u as default};

